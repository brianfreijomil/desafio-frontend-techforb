<main class="relative md:flex w-full flex-col gap-4 px-6 md:px-0">
    <div class="fixed bottom-2 right-2 w-[80px] h-[80px] z-39 flex justify-center items-center md:hidden" >
        <div (click)="openDialogCreateUpdatePlant()" class="cursor-pointer w-[80%] h-[80%] cont-icon-create-plant rounded-full shadow-b shadow-lg flex flex-row justify-center items-center bg-primary">
            <mat-icon>add</mat-icon>
        </div>
    </div>
    <div class="md:hidden">
        <h2 class="text-[16px] font-medium">Monitoreo global</h2>
    </div>
    <article class="w-full flex flex-col gap-2 md:gap-0 md:flex-row md:justify-between">
        <aside class=" w-full md:w-[23%] min-h-8 bg-white rounded-lg md:rounded-lg p-4">
            <div class="w-full h-full flex flex-row justify-between items-center">
                <div class="flex flex-col justify-start items-start ">
                    <p class="text-summary-card font-normal card-p-color">Lecturas OK</p>
                    <p class="text-[20px] md:text-[1.5vw] font-bold card-number-color">{{summaryReadingOk?.value || 0}}</p>
                </div>
                <div class="flex justify-center items-center ">
                    <div class="w-[49px]  md:w-[4.5vw] h-auto">
                        <img class="w-full" src="ok_icon.svg" alt="ok-icon-svg">
                    </div>
                </div>
            </div>
        </aside>
        <aside class=" w-full md:w-[23%] h-auto bg-white rounded-lg md:rounded-lg p-4">
            <div class="w-full h-full flex flex-row justify-between items-center">
                <div class="flex flex-col justify-start items-start">
                    <p class="text-summary-card font-normal card-p-color">Alertas medias</p>
                    <p class="text-[20px] md:text-[1.5vw] font-bold card-number-color">{{summaryReadingMediumAlert?.value || 0}}
                    </p>
                </div>
                <div class="flex justify-center items-center">
                    <div class="w-[49px]  md:w-[4.5vw] h-auto">
                        <img class="w-full" src="warning_icon.svg" alt="warning-icon-svg">
                    </div>
                </div>
            </div>
        </aside>
        <aside class=" w-full md:w-[23%] h-auto bg-white rounded-lg md:rounded-lg p-4">
            <div class="w-full h-full flex flex-row justify-between items-center">
                <div class="flex flex-col justify-start items-start">
                    <p class="text-summary-card font-normal card-p-color">Alertas rojas</p>
                    <p class="text-[20px] md:text-[1.5vw] font-bold card-number-color">{{summaryReadingRedAlert?.value || 0}}
                    </p>
                </div>
                <div class="flex justify-center items-center">
                    <div class="w-[49px]  md:w-[4.5vw] h-auto">
                        <img class="w-full" src="danger_icon.svg" alt="danger-icon-svg">
                    </div>
                </div>
            </div>
        </aside>
        <aside class=" w-full md:w-[23%] h-auto bg-white rounded-lg md:rounded-lg p-4">
            <div class="w-full h-full flex flex-row justify-between items-center">
                <div class="flex flex-col justify-start items-start">
                    <p class="text-summary-card font-normal card-p-color">Sensores deshabilitados</p>
                    <p class="text-[20px] md:text-[1.5vw] font-bold card-number-color">{{sensorsDisabled || 0}}</p>
                </div>
                <div class="flex justify-center items-center">
                    <div class="w-[49px]  md:w-[4.5vw] h-auto">
                        <img class="w-full" src="disabled_icon.svg" alt="disabled-icon-svg">
                    </div>
                </div>
            </div>
        </aside>
    </article>
    <article
        class="relative w-full flex flex-col justify-start rounded-xl bg-white px-4 pb-3 h-[30vh] md:h-[56vh] table-section">
        <div class="w-full header-table flex flex-row justify-between md:justify-start items-end md:items-center gap-6 pt-4 md:pb-4">
            <div>
                <h2 class="text-[18px] font-bold md:text-[16px] md:font-semibold">
                    Plantas
                </h2>
            </div>
            <div class="hidden md:block" *ngIf="showAuthorizedOption()">
                <button (click)="openDialogCreateUpdatePlant()"
                    class="rounded-sm py-1 px-4 b-add-plant text-[12px] font-medium cursor-pointer ">
                    + Crear nueva planta
                </button>
            </div>
            <div>
                <input (input)="filterPlants()" type="text"
                    class="bg-gray-50 border border-gray-300 font-medium text-gray-900 text-xs rounded-lg block w-full p-1.5"
                    placeholder="Buscar por nombre, pais" [(ngModel)]="filter" />
            </div>
            <div>
                <div (click)="sortPlants(plantsSort === 'desc' ? 'asc' : 'desc')" class="btn-ord-table rotate-90">
                    <mat-icon>compare_arrows</mat-icon>
                </div>
            </div>
        </div>
        <div *ngIf="plants.length == 0" class="absolute top-[56%] left-[36%]">
            <p *ngIf="showAuthorizedOption()" class="text-[14px] p-bluesky-color ">Cree una planta para comenzar.</p>
        </div>
        <!-- table mobile-->
        <table class="px-1 w-full bg-white md:hidden">
            <tbody>
            <tr *ngFor="let plant of filteredPlants" class="border-b border-b-gray-300">
                <td class="pt-4 pb-2">
                <div class="flex items-center gap-2 text-[14px] font-medium">
                    <div class="mr-1 w-[24px] h-[14px]">
                        <img class="w-full h-full"
                            [src]="getSrcFlagCountry(plant.country)"
                            [srcset]="getSrcSetFlagCountry(plant.country)"
                            [alt]="plant.country"
                        >
                    </div>
                    {{plant.country}}
                </div>
                <p class="text-[12px] font-normal text-gray-500">{{plant.name}}</p>
                </td>
                <td class="px-2 pt-4 pb-2 text-red-500">{{plant.sensorOk ? plant.sensorOk.value || 0 : 0}}</td>
                <td class="px-2 pt-4 pb-2 text-red-500">{{plant.mediumAlert ? plant.mediumAlert.value || 0 : 0}}</td>
                <td class="px-2 pt-4 pb-2 text-red-500">{{plant.redAlert ? plant.redAlert.value || 0 : 0}}</td>
                <td class="px-2 pt-4 pb-2 text-right">
                    <button class="mr-1" mat-icon-button [matMenuTriggerFor]="menu">
                        <mat-icon>more_vert</mat-icon>
                    </button>
                    <mat-menu #menu="matMenu" xPosition="before">
                        <button (click)="plantSelected = undefined"
                        *ngIf="plantSelected && plantSelected.id === plant.id" mat-menu-item>
                            <mat-icon>visibility_off</mat-icon>
                            <span class="text-xs ">Dejar de ver</span>
                        </button>
                        <button (click)="plantSelected = plant"
                        *ngIf="!plantSelected || plantSelected && plantSelected.id !== plant.id" mat-menu-item>
                            <mat-icon>visibility</mat-icon>
                            <span class="text-xs ">Ver planta</span>
                        </button>
                        <button mat-menu-item (click)="openDialogCreateUpdatePlant(plant)">
                            <mat-icon>edit</mat-icon>
                            <span class="text-xs ">Editar planta</span>
                        </button>
                        <button mat-menu-item (click)="openDialogDeletePlant(plant)">
                            <mat-icon>delete_outline</mat-icon>
                            <span class="text-xs ">Eliminar planta</span>
                        </button>
                    </mat-menu>
                </td>
            </tr>
            </tbody>
        </table>          
        <!-- table desktop/tablet-->
        <table mat-table [dataSource]="filteredPlants" class="hidden md:table mat-elevation-z8 demo-table">
            <ng-container matColumnDef="country">
                <th mat-header-cell *matHeaderCellDef>
                    <p class="text-header-cell">Pa√≠s</p>
                </th>
                <td mat-cell *matCellDef="let element">
                    <div class="flex flex-row items-center">
                        <div class="pr-2 w-[24px] h-[14px]">
                            <img class="w-full h-full"
                                [src]="getSrcFlagCountry(element.country)"
                                [srcset]="getSrcSetFlagCountry(element.country)"
                                [alt]="element.country"
                            >
                        </div>
                        {{element.country}}
                    </div>
                </td>
            </ng-container>
            
            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef><p class="text-header-cell">Nombre <span class="text-header-cell text-header-cell-hide">de la planta</span></p></th>
                <td mat-cell *matCellDef="let element">{{element.name}}</td>
            </ng-container>
    
            <ng-container matColumnDef="read_ok">
                <th mat-header-cell *matHeaderCellDef>
                    <div class="flex flex-row items-center gap-1">
                        <div class="h-[14px] w-[14px]">
                            <img src="icon-ok-small.svg" alt="icon-ok-svg">
                        </div>
                        <p class=" font-medium text-header-cell text-header-cell-hide">Lecturas OK</p>
                    </div>
                </th>
                <td mat-cell *matCellDef="let element">{{element.sensorOk ? element.sensorOk.value || 0 : 0}}
                </td>
            </ng-container>
    
            <ng-container matColumnDef="medium_alerts">
                <th mat-header-cell *matHeaderCellDef>
                    <div class="flex flex-row items-center gap-1">
                        <div class="h-[14px] w-[14px]">
                            <img src="icon-warning-small.svg" alt="icon-warning-svg">
                        </div>
                        <p class=" font-medium text-header-cell text-header-cell-hide">Alertas medias</p>
                    </div>
                </th>
                <td mat-cell *matCellDef="let element">{{element.mediumAlert ? element.mediumAlert.value || 0 :
                    0}}</td>
            </ng-container>
    
            <ng-container matColumnDef="red_alerts">
                <th mat-header-cell *matHeaderCellDef>
                    <div class="flex flex-row items-center gap-1">
                        <div class="h-[14px] w-[14px]">
                            <img src="icon-danger-small.svg" alt="icon-warning-svg">
                        </div>
                        <p class=" font-medium text-header-cell text-header-cell-hide">Alertas Rojas</p>
                    </div>
                </th>
                <td mat-cell *matCellDef="let element">{{element.redAlert ? element.redAlert.value || 0 : 0}}
                </td>
            </ng-container>
    
            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let element">
                    <div class="flex flex-row items-center justify-end gap-6">
                        <div>
                            <button (click)="plantSelected = undefined"
                                *ngIf="plantSelected && plantSelected.id === element.id" type="button"
                                class="px-[1vw] py-[0.5vh] button-table whitespace-nowrap button-stop-to-see-table tracking-wide text-[12px] text-white bg-primary font-medium ">
                                Dejar de ver
                            </button>
                            <button (click)="plantSelected = element"
                                *ngIf="!plantSelected || plantSelected && plantSelected.id !== element.id"
                                type="button"
                                class="button-table button-see-plant tracking-wide text-white bg-primary font-medium ">
                                <span class="px-[1vw] py-[0.5vh] flex flex-nowrap whitespace-nowrap">Ver planta</span>
                            </button>
                        </div>
                        <button class="mr-1" mat-icon-button [matMenuTriggerFor]="menu">
                            <mat-icon>more_vert</mat-icon>
                        </button>
                        <mat-menu #menu="matMenu" xPosition="before">
                            <button mat-menu-item (click)="openDialogCreateUpdatePlant(element)">
                                <mat-icon>edit</mat-icon>
                                <span class="text-xs ">Editar planta</span>
                            </button>
                            <button mat-menu-item (click)="openDialogDeletePlant(element)">
                                <mat-icon>delete_outline</mat-icon>
                                <span class="text-xs ">Eliminar planta</span>
                            </button>
                        </mat-menu>
                    </div>
                </td>
            </ng-container>
    
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
    </article>
    <article class="w-full flex flex-col gap-3 mt-3 pb-24 md:pb-6">
        <div class="w-full flex flex-col">
            <div>
                <h3 class="text-[16px] font-medium">
                    Monitoreo por plantas
                </h3>
            </div>
            <div *ngIf="plantSelected">
                <p class="text-[12px] font-semibold p-bluesky-color">{{plantSelected.country.concat(", ").concat(plantSelected.name+".")}}</p>
            </div>
        </div>
        <div *ngIf="!plantSelected"
            class="bg-container-unselected-plant w-full flex flex-col justify-center items-center ">
            <p class="text-[14px] font-semibold ">Selecciona una planta de la tabla,</p>
            <p class="text-[14px] font-normal ">para mostrar resultados.</p>
        </div>
        <div *ngIf="plantSelected" class="w-full flex flex-col md:flex-row md:flex-wrap gap-4 md:gap-0 md:gap-y-4 md:gap-x-6 ">
            <aside *ngFor="let sensor of plantSelected.sensors"
                class="relative cursor-pointer h-[84px] w-full md:w-[244px] bg-white rounded-xl card-sensor">
                <div
                    class="w-full h-full sensor-card-hover rounded-xl flex flex-row justify-around items-center">
                    <div *ngIf="sensor.isEnabled" class="flex flex-col justify-around items-center">
                        <button (click)="openDialogUpdateSensor(sensor)" class="button-sensor-card">
                            <mat-icon>edit</mat-icon>
                        </button>
                        <p class="text-xs font-medium p-primary-color">Editar</p>
                    </div>
                    <div class="flex flex-col justify-around items-center">
                        <button (click)="openDialogDisableEnableSensor(sensor)" class="button-sensor-card">
                            <mat-icon *ngIf="sensor.isEnabled">visibility_off</mat-icon>
                            <mat-icon *ngIf="!sensor.isEnabled">visibility</mat-icon>
                        </button>
                        <p class="text-xs font-medium p-primary-color">{{sensor.isEnabled ?
                            'Deshabilitar':'Habilitar'}}</p>
                    </div>
                </div>
                <div class="w-full h-full flex flex-row gap-4 items-center justify-between">
                    <div class="flex flex-col justify-start items-start pl-4">
                        <p class="text-[12px] font-normal card-p-color pb-1">{{getSensorName(sensor.type)}}</p>
                        <div class="flex flex-row gap-3">
                            <div class="flex flex-row gap-1 items-center">
                                <div class="h-[14px] w-[14px]">
                                    <img src="icon-ok-small.svg" alt="icon-ok-small-svg">
                                </div>
                                <div>
                                    <p class="text-[12px] font-normal">{{sensor.sensorOk.value}}</p>
                                </div>
                            </div>
                            <div class="flex flex-row gap-1 items-center">
                                <div class="h-[14px] w-[14px]">
                                    <img src="icon-warning-small.svg" alt="icon-ok-warning-svg">
                                </div>
                                <div>
                                    <p class="text-[12px] font-normal">{{sensor.mediumAlert.value}}</p>
                                </div>
                            </div>
                            <div class="flex flex-row gap-1 items-center">
                                <div class="h-[14px] w-[14px]">
                                    <img src="icon-danger-small.svg" alt="icon-danger-small-svg">
                                </div>
                                <div>
                                    <p class="text-[12px] font-normal">{{sensor.redAlert.value}}</p>
                                </div>
                            </div>
                        </div>
                        <p class="text-[12px] font-medium skew-text p-red" *ngIf="!sensor.isEnabled">
                            Deshabilitado</p>
                    </div>
                    <div class="flex justify-center items-center pr-4">
                        <div class="h-auto w-[52px]">
                            <img class="w-full" [src]="getUrlIcon(sensor.type)" alt="icon-temperature-svg">
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </article>
</main>
